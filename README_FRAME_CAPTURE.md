# Frame Capture Inspector Guide

## Overview

`inspect_frame_captures.sh` is a diagnostic tool for examining and analyzing frame captures generated by the VFD animation system. It provides visibility into what animations actually display on screen and validates that they meet quality standards.

Frame captures are automatically created during:
- **Validation phase** - When `vfd_agent.py` validates animation code
- **Playback phase** - When animations run with `--preview` or simulator mode

## Quick Start

```


# Make script executable

chmod +x inspect_frame_captures.sh

# Show summary of all captured frames

./inspect_frame_captures.sh

# Show latest capture with full details

./inspect_frame_captures.sh --latest

# Inspect specific capture

./inspect_frame_captures.sh anim_1762307195_1789.jsonl

# Export to readable text file

./inspect_frame_captures.sh --export-text anim_1762307195_1789.jsonl output.txt

```

## File Locations

Frame captures are stored in:
```

generated_animations/frame_captures/
├── anim_1762307195_1789.jsonl
├── anim_1762307229_8758.jsonl
└── ... (one .jsonl file per animation)

```

Each file contains:
- **Metadata header** - Animation ID, timestamp, idea, frame count
- **Frame lines** - One JSON object per line, containing line1 and line2 content

## Usage Examples

### 1. List All Captures

```

\$ ./inspect_frame_captures.sh

```

Shows a summary table with:
- File name
- Animation ID
- Frame count
- Type (validation or playback)
- Animation idea/concept
- Creation timestamp

**Example output:**
```

✓ Found 3 frame capture(s) in generated_animations/frame_captures

1. anim_1762307195_1789_validation.jsonl
Animation ID: anim_1762307195_1789
Frames: 600
Type: validation
Idea: layered scattering forms wedges
Created: 2025-11-05T18:16:20.811152
2. anim_1762307229_8758_playback.jsonl
Animation ID: anim_1762307229_8758
Frames: 60
Type: playback
Created: 2025-11-05T18:17:45.123456
```

### 2. Inspect Latest Capture

```

\$ ./inspect_frame_captures.sh --latest

```

Or use short form:
```

\$ ./inspect_frame_captures.sh -l

```

Shows:
- Full metadata (ID, timestamps, duration, idea)
- Total frame count
- Frame content statistics
  - Non-empty frames (% with any content)
  - Both rows active (% using both display rows)
  - Empty frames (count)
- Sample frames (first, middle, last)
- Visual display of actual frame content

**Example output:**
```

========================================
Frame Capture Details
========================================

ℹ File: anim_1762395362_5385.jsonl

✓ Metadata:
{
"animation_id": "anim_1762395362_5385",
"timestamp": 1762395380.811152,
"created_at": "2025-11-05T18:16:20.811152",
"total_frames": 600,
"duration": 0.32152652740478516,
"idea": "rhythmic particles",
"validation": true
}

✓ Total frames: 600

ℹ Analyzing frame content...
Non-empty frames: 578/600 (96.3%)
Both rows active: 569/600 (94.8%)
Empty frames: 22

========================================
Sample Frames
========================================

ℹ First frame:
--- Frame 0 ---
[blank]
[blank]
--------------------

ℹ Middle frame (300):
--- Frame 300 ---
*@ o +*@  **  *
o   o%@  \#@oO % o  *
--------------------

ℹ Last frame (599):
--- Frame 599 ---
.*%+ @+O .*.@.\# o\#

# %%o+.% oO+\#+.o\#  .

--------------------
```

### 3. Inspect Specific Capture

```

\$ ./inspect_frame_captures.sh anim_1762307195_1789.jsonl

```

Supports both:
- Full path: `./inspect_frame_captures.sh generated_animations/frame_captures/anim_1234.jsonl`
- Short name: `./inspect_frame_captures.sh anim_1234.jsonl`

Shows the same detailed view as `--latest`.

### 4. Export to Text Format

```

\$ ./inspect_frame_captures.sh --export-text anim_1762307195_1789.jsonl animation_frames.txt

```

Creates a human-readable text file with all frames formatted for easy viewing:

```

============================================================
Animation: anim_1762307195_1789
Frames: 600
Idea: layered scattering forms wedges
============================================================

--- Frame 0 ---

--------------------

--- Frame 1 ---
.
+
--------------------

--- Frame 2 ---
.   @
+   \#
--------------------

[... continues for all 600 frames ...]

```

## Understanding Frame Quality Metrics

When inspecting a capture, the tool analyzes and reports:

### Non-empty Frames
- **Metric:** `N / total (percentage%)`
- **Meaning:** How many frames have ANY visible content (not all spaces)
- **Quality threshold:** > 30% recommended
- **Ideal:** > 90%

### Both Rows Active
- **Metric:** `N / total (percentage%)`
- **Meaning:** How many frames use BOTH display rows (not just top or bottom)
- **Quality threshold:** > 20% minimum (enforced in validation)
- **Ideal:** > 80%

### Empty Frames
- **Metric:** Count
- **Meaning:** Number of frames with zero visible content
- **Quality threshold:** < 70% of total (enforced in validation)
- **Common reason:** Animation startup or ramp-down

## Interpreting Validation vs Playback Captures

### Validation Captures
- Created at 600 fps (fast validation mode)
- Duration: typically ~0.3-1.0 seconds
- Contains 600 frames
- Tests the algorithm before queueing
- Marked with `"validation": true`

### Playback Captures
- Created during actual animation playback
- Duration: matches animation duration (default 10 seconds)
- Contains ~60 frames (6 fps × 10 seconds)
- Real hardware performance
- Marked with `"playback": true`

## Frame Data Format

Each capture file is JSONL (JSON Lines) format:

```

{"_meta": {"animation_id": "anim_123", "total_frames": 600, ...}}
{"frame": 0, "line1": "                    ", "line2": "                    "}
{"frame": 1, "line1": "    content here    ", "line2": "    more here       "}
... (one line per frame)

```

- **Line 1:** Metadata object (key: `_meta`)
- **Lines 2+:** Frame objects, one per line
- **Characters per line:** Always 20 (0-padded with spaces)

## Advanced: Manual Frame Analysis

### View All Frames (Animated Playback)

```

\$ cat generated_animations/frame_captures/anim_1234.jsonl | tail -n +2 | \
python3 -c "
import sys, json
for i, line in enumerate(sys.stdin):
frame = json.loads(line)
print(f'Frame {frame[\"frame\"]:03d}:')
print(frame['line1'])
print(frame['line2'])
print('-' * 20)
"

```

This simulates playback frame-by-frame on your terminal.

### Extract Specific Frame Range

```

\$ cat generated_animations/frame_captures/anim_1234.jsonl | tail -n +2 | \
python3 -c "
import sys, json
for i, line in enumerate(sys.stdin):
if i < 50:  \# First 50 frames
frame = json.loads(line)
print(f'Frame {frame[\"frame\"]}: {frame[\"line1\"]} | {frame[\"line2\"]}')
"

```

### Calculate Custom Statistics

```

\$ cat generated_animations/frame_captures/anim_1234.jsonl | tail -n +2 | \
python3 -c "
import sys, json
frames = [json.loads(line) for line in sys.stdin]
non_empty = sum(1 for f in frames if f['line1'].strip() or f['line2'].strip())
both_rows = sum(1 for f in frames if f['line1'].strip() and f['line2'].strip())
unique_chars = set()
for f in frames:
unique_chars.update(f['line1'] + f['line2'])
unique_chars.discard(' ')

print(f'Total: {len(frames)}')
print(f'Non-empty: {non_empty} ({100*non_empty/len(frames):.1f}%)')
print(f'Both rows: {both_rows} ({100*both_rows/len(frames):.1f}%)')
print(f'Unique characters: {len(unique_chars)} ({sorted(unique_chars)})')
"

```

## Troubleshooting

### No captures found
```

✗ Captures directory not found: generated_animations/frame_captures
ℹ Run vfd_agent.py with --preview or simulator mode to generate captures

```

**Solution:** Run vfd_agent.py to generate animations with frame capture:
```

./vfd_agent.py --preview --idea "your idea"

```

### Failed to parse frame
```

✗ Failed to parse frame N

```

**Solution:** The JSONL file may be corrupted. Check file integrity:
```

tail -20 generated_animations/frame_captures/anim_1234.jsonl

```

### Export file already exists
The script will overwrite without confirmation. Back up if needed:
```

cp generated_animations/frame_captures/anim_1234.jsonl anim_1234.backup.jsonl

```

## Tips & Tricks

### Monitor latest captures in real-time
```

while true; do
clear
./inspect_frame_captures.sh --latest
sleep 5
done

```

### Find captures by idea keyword
```

grep -l "keyword" generated_animations/frame_captures/*.jsonl | head -5

```

### Sort captures by size (largest first)
```

ls -lSr generated_animations/frame_captures/*.jsonl | head -10

```

### Compare two captures visually
```

diff <(./inspect_frame_captures.sh anim_1234.jsonl) \
<(./inspect_frame_captures.sh anim_5678.jsonl)

```

## Integration with Other Tools

### Convert to CSV for analysis
```

python3 << 'EOF'
import json
import csv

with open('generated_animations/frame_captures/anim_1234.jsonl') as f:
next(f)  \# Skip metadata
with open('frames.csv', 'w') as out:
writer = csv.writer(out)
writer.writerow(['frame', 'line1', 'line2'])
for line in f:
frame = json.loads(line)
writer.writerow([frame['frame'], frame['line1'], frame['line2']])
EOF

```

### Generate statistics report
```

for file in generated_animations/frame_captures/*.jsonl; do
echo "=== \$(basename $file) ==="
  ./inspect_frame_captures.sh "$file" | grep -A3 "Analyzing"
done

```

## Reference

- **Frame rate:** 6 fps (default)
- **Display size:** 2 rows × 20 characters
- **Validation FPS:** 600 (fast testing)
- **Capture format:** JSONL (one JSON object per line)
- **Storage location:** `generated_animations/frame_captures/`

## See Also

- `README_VFD_AGENT.md` - Main animation agent documentation
- `frame_capture.py` - Frame capture implementation
- `vfd_agent.py` - Animation generation and playback

---

**Last updated:** November 2025  
**Version:** 1.0
